import{r as m,j as s,R as de,i as Z}from"./index-G7KIa08V.js";import{c as Le,u as Oe,L as Ne,D as ie,a as Re}from"./Divider-jGaY2xLP.js";import{c as le,a as M}from"./helper-DD-oFgKI.js";import{a as D,j as Ae,u as ue,s as Te}from"./store-_E67Wew5.js";import{i as _e}from"./index-OVDJ2T7o.js";import{a as He}from"./env-y9k74Ds6.js";const Pe=t=>{const e=m.useRef();return e.current||(e.current=t()),e.current},me=m.createContext(D([])),Ot=({children:t,images:e})=>{const o=Pe(()=>D(e));return m.useEffect(()=>{Ae.set(o,e)},[e]),s.jsx(me.Provider,{value:o,children:t})},ee=t=>ue(Te(m.useContext(me),m.useCallback(e=>e.find(o=>o.src===t),[t]))),fe=typeof window<"u"?m.useLayoutEffect:m.useEffect,ke=({contexts:t,children:e})=>t.reduceRight((o,r)=>de.cloneElement(r,{children:o}),e),Q=t=>{const e=m.useRef(t);return m.useEffect(()=>{e.current=t},[t]),e};D(!1);const We=(t,e,o={})=>{let r,c,i;const v=()=>{r=void 0,c!==void 0&&(t.apply(void 0,c),c=void 0,i=Date.now(),r=setTimeout(v,e))};return function(...u){const z=Date.now();i===void 0&&o.leading===!1&&(i=z);const g=e-(z-(i??0));g<=0||g>e?(r!==void 0&&clearTimeout(r),t.apply(this,u),i=z,r=setTimeout(v,e)):o.trailing!==!1&&(c=u,r===void 0&&(r=setTimeout(v,g)))}},Nt=t=>typeof t>"u",Rt=t=>t[Math.floor(Math.random()*t.length)],At=(...t)=>{const e={};for(const o of t)for(const r in o)e[r]=o[r];return e};D(0);const Me=D(null),De=()=>ue(Me),[$e,Ue,Fe]=Z(void 0),[Ge,Ye,Ze]=Z({h:0,w:0}),[qe,Tt,Be]=Z({x:0,y:0}),[Ve,_t,Xe]=Z(!1),Ke=[s.jsx($e,{},"ArticleElementProviderInternal"),s.jsx(Ge,{},"ElementSizeProviderInternal"),s.jsx(qe,{},"ElementPositionProviderInternal"),s.jsx(Ve,{},"IsEOArticleElementProviderInternal")],Ht=({children:t,className:e})=>s.jsxs(ke,{contexts:Ke,children:[s.jsx(Je,{}),s.jsx(he,{className:e,children:t})]}),Je=()=>{const t=Ze(),e=Be(),o=Ue();return fe(()=>{if(!o)return;const{height:r,width:c,x:i,y:v}=o.getBoundingClientRect();t({h:r,w:c}),e({x:i,y:v});const u=new ResizeObserver(z=>{const g=z[0],{height:j,width:S,x:N,y:C}=g.contentRect;t({h:j,w:S}),e({x:N,y:C})});return u.observe(o),()=>{u.unobserve(o),u.disconnect()}},[o]),null},he=m.memo(({children:t,className:e})=>{const o=Fe();return s.jsxs("div",{className:le("relative",e),ref:o,children:[t,s.jsx(Qe,{})]})});he.displayName="ArticleElementProviderContent";const Qe=()=>{const t=De(),e=Q(t),o=Xe(),r=m.useRef(null);return m.useEffect(()=>{if(!r.current)return;const c=r.current,i=new IntersectionObserver(v=>{const u=v[0];!u.isIntersecting&&e.current==="down"||o(u.isIntersecting)},{rootMargin:"0px 0px 0px 0px"});return i.observe(c),()=>{i.unobserve(c),i.disconnect()}},[]),s.jsx("div",{ref:r})};/*! medium-zoom 1.1.0 | MIT License | https://github.com/francoischalifour/medium-zoom */var _=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var o=arguments[e];for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(t[r]=o[r])}return t},F=function(e){return e.tagName==="IMG"},et=function(e){return NodeList.prototype.isPrototypeOf(e)},G=function(e){return e&&e.nodeType===1},ae=function(e){var o=e.currentSrc||e.src;return o.substr(-4).toLowerCase()===".svg"},se=function(e){try{return Array.isArray(e)?e.filter(F):et(e)?[].slice.call(e).filter(F):G(e)?[e].filter(F):typeof e=="string"?[].slice.call(document.querySelectorAll(e)).filter(F):[]}catch{throw new TypeError(`The provided selector is invalid.
Expects a CSS selector, a Node element, a NodeList or an array.
See: https://github.com/francoischalifour/medium-zoom`)}},tt=function(e){var o=document.createElement("div");return o.classList.add("medium-zoom-overlay"),o.style.background=e,o},nt=function(e){var o=e.getBoundingClientRect(),r=o.top,c=o.left,i=o.width,v=o.height,u=e.cloneNode(),z=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,g=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0;return u.removeAttribute("id"),u.style.position="absolute",u.style.top=r+z+"px",u.style.left=c+g+"px",u.style.width=i+"px",u.style.height=v+"px",u.style.transform="",u},k=function(e,o){var r=_({bubbles:!1,cancelable:!1,detail:void 0},o);if(typeof window.CustomEvent=="function")return new CustomEvent(e,r);var c=document.createEvent("CustomEvent");return c.initCustomEvent(e,r.bubbles,r.cancelable,r.detail),c},ot=function t(e){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=window.Promise||function(a){function d(){}a(d,d)},c=function(a){var d=a.target;if(d===$){h();return}E.indexOf(d)!==-1&&R({target:d})},i=function(){if(!(H||!n.original)){var a=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0;Math.abs(oe-a)>f.scrollOffset&&setTimeout(h,150)}},v=function(a){var d=a.key||a.keyCode;(d==="Escape"||d==="Esc"||d===27)&&h()},u=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=a;if(a.background&&($.style.background=a.background),a.container&&a.container instanceof Object&&(d.container=_({},f.container,a.container)),a.template){var p=G(a.template)?a.template:document.querySelector(a.template);d.template=p}return f=_({},f,d),E.forEach(function(y){y.dispatchEvent(k("medium-zoom:update",{detail:{zoom:x}}))}),x},z=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t(_({},f,a))},g=function(){for(var a=arguments.length,d=Array(a),p=0;p<a;p++)d[p]=arguments[p];var y=d.reduce(function(l,w){return[].concat(l,se(w))},[]);return y.filter(function(l){return E.indexOf(l)===-1}).forEach(function(l){E.push(l),l.classList.add("medium-zoom-image")}),T.forEach(function(l){var w=l.type,O=l.listener,P=l.options;y.forEach(function(A){A.addEventListener(w,O,P)})}),x},j=function(){for(var a=arguments.length,d=Array(a),p=0;p<a;p++)d[p]=arguments[p];n.zoomed&&h();var y=d.length>0?d.reduce(function(l,w){return[].concat(l,se(w))},[]):E;return y.forEach(function(l){l.classList.remove("medium-zoom-image"),l.dispatchEvent(k("medium-zoom:detach",{detail:{zoom:x}}))}),E=E.filter(function(l){return y.indexOf(l)===-1}),x},S=function(a,d){var p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return E.forEach(function(y){y.addEventListener("medium-zoom:"+a,d,p)}),T.push({type:"medium-zoom:"+a,listener:d,options:p}),x},N=function(a,d){var p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return E.forEach(function(y){y.removeEventListener("medium-zoom:"+a,d,p)}),T=T.filter(function(y){return!(y.type==="medium-zoom:"+a&&y.listener.toString()===d.toString())}),x},C=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=a.target,p=function(){var l={width:document.documentElement.clientWidth,height:document.documentElement.clientHeight,left:0,top:0,right:0,bottom:0},w=void 0,O=void 0;if(f.container)if(f.container instanceof Object)l=_({},l,f.container),w=l.width-l.left-l.right-f.margin*2,O=l.height-l.top-l.bottom-f.margin*2;else{var P=G(f.container)?f.container:document.querySelector(f.container),A=P.getBoundingClientRect(),B=A.width,ve=A.height,ye=A.left,ze=A.top;l=_({},l,{width:B,height:ve,left:ye,top:ze})}w=w||l.width-f.margin*2,O=O||l.height-f.margin*2;var W=n.zoomedHd||n.original,xe=ae(W)?w:W.naturalWidth||w,Ee=ae(W)?O:W.naturalHeight||O,U=W.getBoundingClientRect(),be=U.top,we=U.left,V=U.width,X=U.height,Ie=Math.min(Math.max(V,xe),w)/V,je=Math.min(Math.max(X,Ee),O)/X,K=Math.min(Ie,je),Ce=(-we+(w-V)/2+f.margin+l.left)/K,Se=(-be+(O-X)/2+f.margin+l.top)/K,re="scale("+K+") translate3d("+Ce+"px, "+Se+"px, 0)";n.zoomed.style.transform=re,n.zoomedHd&&(n.zoomedHd.style.transform=re)};return new r(function(y){if(d&&E.indexOf(d)===-1){y(x);return}var l=function B(){H=!1,n.zoomed.removeEventListener("transitionend",B),n.original.dispatchEvent(k("medium-zoom:opened",{detail:{zoom:x}})),y(x)};if(n.zoomed){y(x);return}if(d)n.original=d;else if(E.length>0){var w=E;n.original=w[0]}else{y(x);return}if(n.original.dispatchEvent(k("medium-zoom:open",{detail:{zoom:x}})),oe=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,H=!0,n.zoomed=nt(n.original),document.body.appendChild($),f.template){var O=G(f.template)?f.template:document.querySelector(f.template);n.template=document.createElement("div"),n.template.appendChild(O.content.cloneNode(!0)),document.body.appendChild(n.template)}if(n.original.parentElement&&n.original.parentElement.tagName==="PICTURE"&&n.original.currentSrc&&(n.zoomed.src=n.original.currentSrc),document.body.appendChild(n.zoomed),window.requestAnimationFrame(function(){document.body.classList.add("medium-zoom--opened")}),n.original.classList.add("medium-zoom-image--hidden"),n.zoomed.classList.add("medium-zoom-image--opened"),n.zoomed.addEventListener("click",h),n.zoomed.addEventListener("transitionend",l),n.original.getAttribute("data-zoom-src")){n.zoomedHd=n.zoomed.cloneNode(),n.zoomedHd.removeAttribute("srcset"),n.zoomedHd.removeAttribute("sizes"),n.zoomedHd.removeAttribute("loading"),n.zoomedHd.src=n.zoomed.getAttribute("data-zoom-src"),n.zoomedHd.onerror=function(){clearInterval(P),console.warn("Unable to reach the zoom image target "+n.zoomedHd.src),n.zoomedHd=null,p()};var P=setInterval(function(){n.zoomedHd.complete&&(clearInterval(P),n.zoomedHd.classList.add("medium-zoom-image--opened"),n.zoomedHd.addEventListener("click",h),document.body.appendChild(n.zoomedHd),p())},10)}else if(n.original.hasAttribute("srcset")){n.zoomedHd=n.zoomed.cloneNode(),n.zoomedHd.removeAttribute("sizes"),n.zoomedHd.removeAttribute("loading");var A=n.zoomedHd.addEventListener("load",function(){n.zoomedHd.removeEventListener("load",A),n.zoomedHd.classList.add("medium-zoom-image--opened"),n.zoomedHd.addEventListener("click",h),document.body.appendChild(n.zoomedHd),p()})}else p()})},h=function(){return new r(function(a){if(H||!n.original){a(x);return}var d=function p(){n.original.classList.remove("medium-zoom-image--hidden"),document.body.removeChild(n.zoomed),n.zoomedHd&&document.body.removeChild(n.zoomedHd),document.body.removeChild($),n.zoomed.classList.remove("medium-zoom-image--opened"),n.template&&document.body.removeChild(n.template),H=!1,n.zoomed.removeEventListener("transitionend",p),n.original.dispatchEvent(k("medium-zoom:closed",{detail:{zoom:x}})),n.original=null,n.zoomed=null,n.zoomedHd=null,n.template=null,a(x)};H=!0,document.body.classList.remove("medium-zoom--opened"),n.zoomed.style.transform="",n.zoomedHd&&(n.zoomedHd.style.transform=""),n.template&&(n.template.style.transition="opacity 150ms",n.template.style.opacity=0),n.original.dispatchEvent(k("medium-zoom:close",{detail:{zoom:x}})),n.zoomed.addEventListener("transitionend",d)})},R=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=a.target;return n.original?h():C({target:d})},q=function(){return f},I=function(){return E},L=function(){return n.original},E=[],T=[],H=!1,oe=0,f=o,n={original:null,zoomed:null,zoomedHd:null,template:null};Object.prototype.toString.call(e)==="[object Object]"?f=e:(e||typeof e=="string")&&g(e),f=_({margin:0,background:"#fff",scrollOffset:40,container:null,template:null},f);var $=tt(f.background);document.addEventListener("click",c),document.addEventListener("keyup",v),document.addEventListener("scroll",i),window.addEventListener("resize",h);var x={open:C,close:h,toggle:R,update:u,clone:z,attach:g,detach:j,on:S,off:N,getOptions:q,getImages:I,getZoomedImage:L};return x};function rt(t,e){e===void 0&&(e={});var o=e.insertAt;if(!(!t||typeof document>"u")){var r=document.head||document.getElementsByTagName("head")[0],c=document.createElement("style");c.type="text/css",o==="top"&&r.firstChild?r.insertBefore(c,r.firstChild):r.appendChild(c),c.styleSheet?c.styleSheet.cssText=t:c.appendChild(document.createTextNode(t))}}var it=".medium-zoom-overlay{position:fixed;top:0;right:0;bottom:0;left:0;opacity:0;transition:opacity .3s;will-change:opacity}.medium-zoom--opened .medium-zoom-overlay{cursor:pointer;cursor:zoom-out;opacity:1}.medium-zoom-image{cursor:pointer;cursor:zoom-in;transition:transform .3s cubic-bezier(.2,0,.2,1)!important}.medium-zoom-image--hidden{visibility:hidden}.medium-zoom-image--opened{position:relative;cursor:pointer;cursor:zoom-out;will-change:transform}";rt(it);const at=ot,st=t=>de.createElement("img",t,t.children),ct="_error_hef56_1",dt="_loading_hef56_2",lt="_loaded_hef56_6",ut="_imageLoad_hef56_1",ce={error:ct,loading:dt,loaded:lt,imageLoad:ut},te=_e({base:"rounded-xl overflow-hidden text-center inline-flex items-center justify-center duration-200",variants:{status:{loading:"hidden opacity-0",loaded:"opacity-100 block",error:"hidden opacity-0"}}});let J;const mt=({alt:t,src:e,title:o,zoom:r,placeholder:c,height:i,width:v})=>{const[u]=m.useState(()=>{if(He)return null;if(J)return J;const h=at(void 0);return J=h,h}),z=o||t,[g,j]=m.useState("loading"),S=Oe(),N=m.useCallback(h=>{S.current||j(h)},[S]),C=m.useRef(null);return fe(()=>{if(g!=="loaded"||!r)return;const h=C.current;if(h)return u.attach(h),()=>{u.detach(h)}},[r,u,g]),s.jsxs("figure",{children:[s.jsx("span",{className:"relative flex justify-center","data-hide-print":!0,children:s.jsxs(Ne,{placeholder:c,offset:30,children:[s.jsx("span",{children:g!=="loaded"&&c}),g==="error"&&s.jsxs("div",{className:"absolute inset-0 z-[1] flex flex-col gap-8 center",children:[s.jsx("i",{className:"icon-[mingcute--close-line] text-4xl text-red-500"}),s.jsx("span",{children:"图片加载失败"}),s.jsx(ie,{className:"w-[80px] opacity-80"}),s.jsx("a",{href:e,target:"_blank",rel:"noreferrer",children:s.jsx("span",{children:"查看原图"})})]}),s.jsx(ge,{height:i,width:v,src:e,title:o,alt:t||o||"",ref:C,onLoad:()=>{N("loaded")},onError:()=>N("error"),className:te({status:g,className:ce.loaded}),onAnimationEnd:h=>{h.target.classList.remove(ce.loaded)}})]})}),s.jsx("img",{className:"max-w-1/3 hidden print:block",src:e,alt:t||o}),!!z&&s.jsxs("figcaption",{className:"mt-1 flex flex-col items-center justify-center",children:[s.jsx(ie,{className:"w-[80px] opacity-80"}),s.jsx("span",{children:z})]})]})},ft=t=>{const e=m.useMemo(()=>s.jsx(ht,{...t}),[t]);return s.jsx(mt,{zoom:!0,placeholder:e,...t})},ht=({src:t,containerWidth:e,height:o,width:r,accent:c})=>{const i=ee(t),v=c||(i==null?void 0:i.accent),u=m.useMemo(()=>{let z=o,g=r;if(!z||!g){if(!i)return;z=i.height,g=i.width}if(e<=0)return;const{height:j,width:S}=Le({width:g,height:z,max:{width:e,height:1/0}});return{scaleHeight:j,scaleWidth:S}},[o,r,e,i]);return u?s.jsx("span",{className:`image-placeholder ${te.base}`,"data-width":u.scaleWidth,"data-height":u.scaleHeight,"data-from-record-height":i==null?void 0:i.height,"data-from-record-width":i==null?void 0:i.width,"data-src":t,style:{height:u.scaleHeight,width:u.scaleWidth,backgroundColor:v}}):s.jsx(gt,{accent:v})},gt=({accent:t})=>s.jsx("span",{className:le("image-placeholder",te.base,"h-[300px] w-full bg-slate-300 dark:bg-slate-700"),style:{backgroundColor:t,outline:void 0}}),ge=m.forwardRef(({src:t,alt:e,...o},r)=>{const{height:c,width:i}=ee(t)||o;return!c||!i?s.jsx("img",{alt:e,src:t,ref:r,...o}):s.jsx(st,{alt:e||"",fetchPriority:"high",priority:!0,src:t,...o,height:+c,width:+i,ref:r})});ge.displayName="OptimizedImage";const pt="_root_1ug9l_1",vt="_indicator_1ug9l_2",yt="_container_1ug9l_7",zt="_child_1ug9l_17",Y={root:pt,indicator:vt,container:yt,child:zt},ne=60,xt=15,Et=5e3,Pt=t=>{const{images:e}=t,[o,r]=m.useState(null),[,c]=m.useState({}),i=m.useRef(0);m.useEffect(()=>{if(!o)return;const I=new ResizeObserver(()=>{c({}),L(o)});function L(E){const T=E.children.item(0);T&&(i.current=T.clientWidth)}return L(o),I.observe(o),()=>{I.disconnect()}},[o]);const[v,u]=m.useState(0),z=m.useCallback(We(I=>{const L=I.target,E=Math.floor((L.scrollLeft+ne+15)/i.current);u(E)},60),[]),g=m.useCallback(I=>{o&&o.scrollTo({left:i.current*I,behavior:"smooth"})},[o]),j=m.useRef(null),S=Q(v),N=Q(e.length),C=m.useRef(!0),h=m.useRef(!0),R=m.useCallback(()=>{h.current&&(h.current=!1,clearInterval(j.current))},[]),{ref:q}=Re({initialInView:!1,triggerOnce:e.length<2,onChange(I){N.current<2||!h.current||(I?j.current=setInterval(()=>{S.current+1>N.current-1&&C.current&&(C.current=!1),S.current-1<0&&!C.current&&(C.current=!0);const L=S.current+(C.current?1:-1);g(L)},Et):j.current=clearInterval(j.current))}});return m.useEffect(()=>()=>{clearInterval(j.current)},[]),s.jsxs("div",{className:M("w-full","relative",Y.root),ref:q,onTouchMove:R,onWheel:R,children:[s.jsx("div",{className:M("w-full overflow-auto whitespace-nowrap",Y.container),onTouchStart:R,onScroll:z,ref:r,onTouchMove:R,onWheel:R,children:e.map(I=>s.jsx(pe,{image:I},I.url))}),s.jsx("div",{className:M(Y.indicator,"space-x-2"),children:Array.from({length:e.length}).map((I,L)=>s.jsx("div",{className:M("h-[6px] w-[6px] cursor-pointer rounded-full bg-stone-600 opacity-50 transition-opacity duration-200 ease-in-out",v==L&&"!opacity-100"),onClick:g.bind(null,L)},L))})]})},bt={width:`calc(100% - ${ne}px)`,marginRight:`${xt}px`},pe=m.memo(({image:t})=>{const e=ee(t.url),o=t.name,c=t.footnote||(["!","¡"].some(v=>v==(o==null?void 0:o[0]))?o==null?void 0:o.slice(1):"")||"",{w:i}=Ye();return s.jsx("div",{style:bt,className:M(Y.child,"inline-block self-center"),children:s.jsx(ft,{accent:e==null?void 0:e.accent,src:t.url,alt:c,containerWidth:i-ne})},`${t.url}-${t.name||""}`)});pe.displayName="GalleryItem";export{ft as F,Pt as G,st as I,Ot as M,Ht as W,Pe as a,ee as b,at as c,Nt as i,At as m,Rt as s,Ye as u};
